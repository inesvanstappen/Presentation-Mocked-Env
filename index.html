<!DOCTYPE html>
<html>

<head lang="en">
  <meta charset="UTF-8">
  <title>JWorks - A base template</title>
  <link rel="stylesheet" href="css/reveal.css">
  <link rel="stylesheet" href="css/ordina.css" id="theme">
  <link rel="stylesheet" href="css/custom.css">

  <!-- Printing and PDF exports -->
  <script>
    var link = document.createElement('link');
    link.rel = 'stylesheet';
    link.type = 'text/css';
    link.href = window.location.search.match(/print-pdf/gi) ? 'css/print/pdf.css' : 'css/print/paper.css';
    document.getElementsByTagName('head')[0].appendChild(link);
  </script>

  <script src="js/head.min.js"></script>
  <!--Add support for earlier versions of Internet Explorer -->
  <!--[if lt IE 9]>
    <script src="js/html5shiv.js"></script>
    <![endif]-->
</head>

<body>
  <div class="reveal">
    <div class="slides">
      <section>
        <h1>Best practice: </br> mock environment</h1>
        <img src="img/jworks-logo.png" style="vertical-align: bottom;" width="22.5%" />
      </section>

      <section>
        <h2>Hi, my name is Ines.</h2>
        <p>
          Front-end Developer
          <br /> Ordina Belgium
          <br /> @InesVanStappen
          <br /> https://github.com/inesvanstappen
        </p>
      </section>

      <section>
        <h2>Index</h2>
        <ul>
          <li>Why?</li>
          <li>Setup</li>
        </ul>
      </section>

      <section>
        <h2>Why?</h2>
        <ul>
          <li>Testing</li>
          <li>Local development</li>
          <small>Vpn down, on the road, ...</small>
        </ul>
      </section>

      <section>
        <section>
          <h2>Set-up</h2>
          <ul>
            <li>Mock service</li>
            <li>Spies</li>
            <li>Import in module</li>
          </ul>
        </section>
        <section>
          <h2>Sidenote</h2>
          <ul>
            <li>Angular CLI v6</li>
            <li>Angular v6</li>
            <li>RxJS v6</li>
          </ul>
        </section>
      </section>
      <section>
        <section>
          <h2>Mock services</h2>
          <p>Purpose: creating a fake service (without logic) that is gives back fake data.</p>
        </section>
        <section>
          <h2>object.service.mock.ts</h2>
          <h5>Pretty Code</h5>
          <pre><code data-trim contenteditable>
export const MockReceiverService = {
  getReceivers: () => {
    const receivers: Receiver[] = [{
      id: '1',
      numberOfBeacons: 3,
      lat: 40,
      long: 45,
    }, {
      id: '2',
      numberOfBeacons: 7,
      lat: -59,
      long: 62,
    }, {
      id: '3',
      numberOfBeacons: 2,
      lat: -59,
      long: -66,
    }];
    return of(receivers);
  }
}</code></pre>
        </section>
      </section>
      <section>
        <section>
          <h2>Stubs</h2>
          <h5>What are they?</h5>
          <blockquote cite="https://gaboesquivel.com/blog/2014/unit-testing-mocks-stubs-and-spies/">
            Test stubs are fake objects with pre-programmed behavior ( Simulation of behaviour from other units ), Most of times they
            are simply returning fixed values. They are typically used for one of two reasons:
            <ul>
              <li>To avoid some inconvenient interface - for instance to avoid making actual requests to a server from tests.</li>
              <li>To feed the system with known data, forcing a specific code path.</li>
            </ul>
          </blockquote>
        </section>
        <section>
          <h2>Spies</h2>
          <h5>What are they?</h5>
          <blockquote cite="https://alligator.io/angular/testing-with-spies/">
            Jasmine spies are used to track or stub functions or methods. Spies are an easy way to check if a function was called or
            to provide a custom return value. We can use spies to test components that depend on a service and avoid actually
            calling the serviceâ€™s methods to get a value.
          </blockquote>
        </section>
      </section>
      <section>
        <section>
          <h2>Let's set up the environment!</h2>
        </section>
        <section>
          <h2>environment/environment.mock.ts</h2>
          <pre><code data-trim contenteditable>
export const environment = {
  production: false,
  mocked: true,
  url: '',
};
                  </code></pre>
          <p style="color: red; font-weight: bold">Important always import environment/environment.ts</p>
        </section>
        <section>
          <h2>angular.json</h2>
          <pre><code>
"configurations": {
  "production": {
    "fileReplacements": [
      {
        "replace": "src/environments/environment.ts",
        "with": "src/environments/environment.prod.ts"
      }
    ],
    ...
  },
  "mocked": {
    "fileReplacements": [
      {
        "replace": "src/environments/environment.ts",
        "with": "src/environments/environment.mocked.ts"
      }
    ]
  }
}</code></pre>
        </section>
        <section>
          <h2>angular.json</h2>
          <pre><code>
  "serve": {
    ...
    "configurations": {
      "production": {
        "browserTarget": "temp:build:production"
      },
      "mocked": {
        "browserTarget": "temp:build:mocked"
      }
    }
  },  
  </code></pre>
          <p>Run with ng serve -c=mocked</p>
        </section>
        <section>
          <h2>services/index.ts</h2>
          <pre><code data-trim contenteditable>
export const EnvReceiverService =
  environment.mocked ?
  { provide: ReceiverService, useValue: MockReceiverService } :
  BookService;
                  </code></pre>
        </section>
        <section>
          <h2>app.module.ts</h2>
          <pre><code data-trim contenteditable>
@NgModule({
declarations: [
  ...
],
imports: [
  ...
],
providers: [
  EnvBookService,
  ...
],
bootstrap: [AppComponent]
})
export class AppModule { }
                  </code></pre>
        </section>
      </section>
      <section>
        <section>
          <h2>Testing</h2>
        </section>
        <section>
          <h2>object.service.spy.ts</h2>
          <pre><code data-trim contenteditable>
export const ReceiverServiceSpy = {
  getReceivers: jasmine.createSpy('getReceivers', MockReceiverService.getReceivers).and.callThrough(),
  //other spy methods
};</code></pre>
        </section>
        <section>
          <h2>object.sandbox.spec.ts</h2>
          <pre><code>
TestBed.configureTestingModule({
  imports: [
  ],
  providers: [
    ReceiverSandbox,
    { provide: ReceiverService, useValue: ReceiverServiceSpy },
  ]
});
          </code></pre>
        </section>
        <section>
          <h2>tsconfig.app.json</h2>
          <p>Add to remove jasmine warning when compiling.</p>
          <small>Spies are for testing purpose only so they don't need to be compiled with your application.</small>
          <p style="color:red; font-size: 1.1rem;">
            ERROR in src/app/services/beacon.service.spy.ts(4,15): error TS2304: Cannot find name 'jasmine'. </br>
            src/app/services/receiver.service.spy.ts(4,17): error TS2304: Cannot find name 'jasmine'. </br>
            src/app/services/receiver.service.spy.ts(5,25): error TS2304: Cannot find name 'jasmine'.
          </p>
          <pre><code data-trim contenteditable>
"exclude": [
  ... 
  "**/*.spec.ts",
  "**/*.spy.ts"
]</code></pre>
        </section>
      </section>
      <!-- **********
                DO NOT REMOVE
            ********** -->
      <section style="text-align: left;">
        <h2>Thanks for watching!</h2>
        <p class="fragment">Now kick some ass!</p>
      </section>

      <section style="text-align: left;" data-background="img/jworks-wallpaper-3.jpg"></section>
    </div>
  </div>
  <script src="js/reveal.js"></script>
  <script>
    Reveal.initialize({
      transition: 'convex',
      dependencies: [
        // Cross-browser shim that fully implements classList - https://github.com/eligrey/classList.js/
        {
          src: 'lib/js/classList.js',
          condition: function () {
            return !document.body.classList;
          }
        },
        // Interpret Markdown in <section> elements
        {
          src: 'plugin/markdown/marked.js',
          condition: function () {
            return !!document.querySelector('[data-markdown]');
          }
        },
        {
          src: 'plugin/markdown/markdown.js',
          condition: function () {
            return !!document.querySelector('[data-markdown]');
          }
        },
        // Syntax highlight for <code> elements
        {
          src: 'plugin/highlight/highlight.js',
          async: true,
          callback: function () {
            hljs.initHighlightingOnLoad();
          }
        },
        // Zoom in and out with Alt+click
        {
          src: 'plugin/zoom-js/zoom.js',
          async: true
        },
        // Speaker notes
        {
          src: 'plugin/notes/notes.js',
          async: true
        }
      ]
    });
  </script>
</body>

</html>